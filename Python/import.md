# Pythonにおけるインポート
[link](https://docs.python.org/ja/3/reference/import.html)

## モジュールとパッケージ
- pythonではモジュールという単位でライブラリをインポートする。
- モジュールをまとめたものをパッケージという。パッケージ自体もモジュールの一種である。
- 基本的にはファイルがモジュール、ディレクトリがパッケージである。
- パッケージには通常のパッケージと名前空間パッケージの2種類がある。
- 通常のパッケージ
  - ファイルシステム上のディレクトリは通常のパッケージである。
  - `__init__.py` を持つ。
  - `__init__.py`
    - パッケージのインポート時に実行され、パッケージを初期化する。
    - サブモジュールなどからこのパッケージの名前空間に属性をバインドする。
- 名前空間パッケージ
  - [](https://packaging.python.org/ja/latest/guids/packaging-namespace-packages/)
  - 別々のパッケージに含まれるサブモジュールが同じ名前空間（パッケージ）に属することが可能になる。
  - `__init__.py` がないディレクトリは**暗黙の名前空間パッケージ**となる。
- 他にpkgutil型名前空間パッケージ、pkg_resources型名前空間パッケージなどもあるがすでに非推奨である。

## モジュールの属性
- `__name__`
  - 
- `__loader__`
  - 
- `__package__`
  - 
- `__spec__`
  - 
- `__path__`
  - 
- `__file__`
  - 
- `__cached__`
  - 

## モジュールの検索順
1. `sys.modules`
   - すでにロードしたモジュール。ロード済みモジュールの、名前からモジュールオブジェクトへのマッピング。
   - 最初に検索される。
   - ロード済みモジュールまでの中間パスも含まれる。
2. メタパスファインダー (`sys.meta_path`)
   - メタパスファインダーオブジェクト
   - デフォルトのファインダーは3つ。
     - 組み込みモジュール (`importlib.machinery.BuiltinImporter`)
     - freezeモジュール (`importlib.machinery.FrozenImporter`)
     - インポートパスからの検索 (パスベース・ファインダー)
   - ユーザーが追加することもできる。

- パスベース・ファインダー (`importlib.abc.PathFinder`)
  - インポートパスから検索する。
    - `sys.path` : `PYTHONPATH` とインストールごとの場所。
    - `sys.path_hooks` : パスフック。パスエントリに対し、その場所を検索できるパスエントリファインダーを生成して返す。
    - `sys.path_importer_cache` : パスエントリとそれに割り当てたパスエントリファインダーのキャッシュ。
- パスエントリ・ファインダー (`importlib.abc.PathEntryFinder`)

## インポート文
### 絶対インポート
```py
import A.B.C
```

- モジュール探索パス (`sys.path`)
  1. 実行方法により以下のどちらか。
     - スクリプトとして実行した場合 (`python script.py`) は、そのスクリプトのディレクトリ。
     - モジュールとして実行した場合 (`python -m script.py`) は、コマンドの実行ディレクトリ。
  2. `PYTHONPATH` 環境変数。セミコロンで区切って複数パス指定可。
  3. python本体インストール時に同梱されていたライブラリの格納パス
  4. 現在のpython環境に(pipで)インストールしたライブラリの格納パス
- モジュール探索パスが相対パスのこともある。相対パスの場合は実行ディレクトリを基準に解決される。

### 相対インポート
```py
from ../../X import A
from .Y import B
```
- モジュール探索パスのトップレベルにあるディレクトリは相対インポートではインポートできない。

## srcレイアウト


## 設定ファイルの指定
- インポートの性質上、特定の設定ファイルを自動的に読み込むようなことがやりにくい。
  - 絶対パス指定はNGだし、相対パスだとどこ基準で解決されるかは実行により異なる。
- OSSでは特定の名前のファイルを、実行ディレクトリから順に上に遡って探すのが主流っぽい。
  - uvはそんな感じのようだ
