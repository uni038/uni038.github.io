# ネットワークスタック
- アプリケーション層
  - DHCP
  - DNS
  - FTP
  - HTTP
  - IMAP
  - LDAP
  - MQTT
  - NTP
  - SNTP
  - POP
  - RTP
  - SMTP
  - SNMP
  - SSH
  - Telnet
  - SSL -> TLS
- トランスポート層
  - TCP
  - UDP
  - QUIC
- インターネット層
  - IP
  - ICMP
  - IPsec
- リンク層
  - ARP
  - イーサネット

## イーサネット
- IEEE802.3
  - イーサネットの規定。
  - 規格を n BASE m と表記する。
    - n は伝送速度。数値の場合はメガビット/秒
    - m は伝送媒体・伝送距離・伝送符号など。Tはツイストペアケーブル
    - 主流は 1000BASE-T (1Gbps)
    - 10GBASE-T も存在するが、カテゴリ6以上のツイストペアケーブルが必要なため普及していない
- マルチギガビットイーサネット
  - 2.5Gbps/5Gbpsの規格の総称。マルチギガビットとは1Gbpsと10Gbpsの中間を意味する。
  - カテゴリー5eのケーブルを使用する。
  - 2.5GBASE-T、5GBASE-T

### LLC, MAC
- イーサネットはOSI参照モデルでいうデータリンク層をさらに2つの層に分ける。
  - LLC (Logical Link Control、論理リンク制御)
    - 多重化・非多重化、フロー制御、欠落検知、再送制御
    - 下層での物理媒体による差異を吸収し、上位層から統一的に扱えるようにする
      - 有線LANについては現在はイーサネット以外が使われなくなったため必要なくなった
  - MAC (Medium Access Control、媒体アクセス制御)
    - 同じ物理媒体を共有する通信を制御する仕組み
    - CSMA/CD (Carrier Sense Multiple Access with Collision Detection、搬送波感知多重アクセス/衝突検出)
      - 同一の物理回線を共用するための方式。物理回線を流れる信号を監視し、誰も通信していないことを確認して送信する
      - LANスイッチの普及により使用されなくなった（全二重通信）
    - CSMA/CA (Carrier Sense Multiple Access/Collision Avoidance)
      - 通信の終了を検知して送信を開始する
      - 衝突を検知しにくい無線LANで使われる

### イーサネットフレーム
- 物理層パケット
  - プリアンブル (7 Byte)
  - SFD (1 Byte)
  - イーサネットフレーム
    - 宛先MACアドレス (6 Byte)
    - 送信元MACアドレス (6 Byte)
    - (VLANタグ (4/8 Byte))
    - タイプ/長さ (2 Byte)
    - ペイロード (46-1500 Byte)
    - FCS (4 Byte)
  - パケット間隔 (12 Byte)

- プリアンブル(preamble)
  - 1と0を交互に7バイト送信する。
- SFD (start frame delimiter)
  - フレーム開始区切り。10101011
- MACアドレス
  - 1バイトは16進数で2桁なので、16進数表記すると12桁。
  - 前半3バイトは OUI (Organizationally Unique Identifier) といい、IEEEによって組織に割り当てられている。後半3バイトは各組織が一意に割り振る。
  - 最初の1バイトの1番下のビットをIGビットといい、0がユニキャストアドレス、1がマルチキャストアドレスを意味する。同様に最初の1バイトの下から2番目のビットはGLビットといい、0がグローバルアドレス、1がローカルアドレスを意味する。
    - 実際の伝送は各バイトごとに1番下のビットから1番上のビットへの順で行われる。
  - FF-FF-FF-FF-FF-FF はブロードキャストアドレスである。
- VLANタグ
  - 仮想LAN(VLAN)において、どのVLANに所属するかを識別するタグ。
- タイプ/長さ
  - 0x0600(1536)以上の場合はデータの種別を表す。これを EtherType という。
    - 0x0800 : IPv4
    - 0x0806 : ARP
    - 0x8100 : タグVLAN
    - 0x86DD : IPv6
  - 0x05DC(1500)以下の場合はペイロード長を表す。
- FCS(フレームチェックシーケンス)
  - 巡回冗長検査(CRC)も参照。

- 拡張イーサネット
- オーバーレイネットワーク

### 無線LAN
- IEEE 802.11
  - a/b/g/j/n/ac/ad/ax/...
  - 物理層とMAC層の2つの規格で構成される
  - CSMA/CA
    - ACK方式 (Acknowledgement, 確認応答)
      - データを直接送信し、受信側がACK応答を返す方式
      - 隠れ端末問題に対応できない
    - RTS/CTS方式 (Request To Send / Clear To Send)
      - データ本体の送信前に送信権獲得の要求(RTS)を送信し、獲得できたらデータ本体を送信する方式
      - 受信側は送信権を与えた先を保存している
      - 隠れ端末に対応できる
    - いずれの方式も送信前に誰も送信中でないことは確認する
    - さらし端末問題
      - BSSカラー
        - どこに対して送信しているかをフレームに埋め込む
        - 衝突回避をしなくてよいときはしないようにできる
- Wi-Fi
  - Wi-Fi Allianceの規格
  - IEEE規格に対応している
    - Wi-Fi 4 → 802.11n
    - Wi-Fi 5 → 802.11ac
    - …
  - 
- 無線PAN
  - IEEE 802.15
  - Bluetooth (IEEE 802.15.1)
- 高速化技術
  - MIMO (Multiple Input Multiple Output)
    - 送信側・受信側ともに複数のアンテナを持つ場合に、データを複数のストリームに分割し並列で送受信する
    - MU-MIMO (Multi User MIMO)
  - OFDM (Orthogonal Frequency Division Multiplexing、直交周波数分割多重方式)
    - ?
    - OFDMA (Orthogonal Frequency Division Multiple Access)
  - チャネルボンディング
    - 複数のチャネルを1つの高速なチャネルのように扱う技術
  - マルチバンド (デュアルバンド、トライバンド)
    - 複数の周波数帯で同時に通信する
- 周波数帯
  - 2.4 GHz帯 (2.4-2.5 GHz)
    - 減衰しにくく障害物に強い
    - ISMバンド (産業科医療学用バンド)のうちの1つであるため、電子レンジ等と干渉する
  - 5 GHz帯 (5.150-5.350 GHz, 5.470-5.725 GHz)
    - 伝送速度が早い
    - 減衰しやすく障害物に弱い
    - レーダーと同じ周波数帯のため干渉する
    - W53,W56(後述)は気象レーダー等と干渉するため、DFS (Dynamic Frequency Selection, 動的電波周波数選択)により干渉の回避が義務付けられている
  - 6 GHz帯
    - Wi-Fi 6E以降のみ
- チャネル
  - 各周波数帯には複数のチャネルが定められている。チャネルは中心周波数とチャネル幅からなる
  - 同じ周波数帯でも規格によりチャネルの設定の仕方は異なる
  - 隣り合うチャネルとの中心周波数の間隔がチャネル幅を下回っている場合がある。その場合、干渉せずに使用できるチャネルは実質的にはもっと少なくなる
    - 2.4 GHz帯
      - 2.412, 2.437, 2.462 の3つ
    - 5 GHz帯
      - 5.180, 5.200, 5.220, 5.240 (W52、4チャンネル)
      - 5.260, 5.280, 5.300, 5.320 (W53、4チャンネル)
      - 5.500 ～ 5.720 (W56、12チャンネル)
    - 6 GHz帯
      - 24チャンネル
- アクセスポイント (AP)
  - 無線LANにおけるブリッジ(L2、MACアドレスレベル)
  - インフラストラクチャモード
    - アクセスポイントを使う
  - アドホックモード
    - アクセスポイントを使わず端末間で直接通信する
  - 1台のAPがカバーする無線LANセグメントを BSS (Basic Service Set)という
    - BSSは BSS ID で識別し、APのMACアドレスが使われる
  - 複数のAPを接続して構成した無線LANセグメントを ESS (Extended Service Set)という
    - ESSは ESS ID (SSID, 32文字以下の英数字)で識別する
  - APはSSIDをビーコン信号で発している (パッシブスキャン)
  - ANY接続
    - 通信状態が一番いいAPに接続する
- フレームアグリゲーション
  - 同じ宛先のフレームをまとめる
- ローミング
  - 移動する端末が通信が途絶えないよう、同じESSの最寄りのAPに自動接続する機能

